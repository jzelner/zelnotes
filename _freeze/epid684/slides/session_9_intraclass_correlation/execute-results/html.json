{
  "hash": "16b3961d4500d3febcbc8449f0c432ba",
  "result": {
    "markdown": "---\npagetitle: \"Individual vs. Context vs. Space vs. Place\"\nformat: \n    revealjs:\n        theme: [solarized, styles.scss]\n        incremental: true\n        bibliography: \n          - \"/Users/jzelner/Dropbox/repos/bibtex-library/jz_library.bib\"\n          - \"../refs.bib\"\n---\n## {{< meta pagetitle >}}\n\n<div class=\"paddeddiv\">\n  <p style=\"font-size:0.5em; text-align: left;\">\n      EPID 684  \n      Spatial Epidemiology  \n      University of Michigan School of Public Health\n      <br><br>\n      Jon Zelner  \n      `jzelner@umich.edu`  \n      [`epibayes.io`](https://epibayes.io) \n    </p>\n</div>\n\n![](/images/epid_logo.png){.absolute bottom=0 right=50 width=\"400\" height=\"100\"}\n\n\n\n## Today's <span class=\"alert\">Theme</span> {.imgslide}\n\n<img src=\"/images/merlo_sim_data.png\">\n\nHow can we characterize the relative importance of <span class=\"alert\">individual</span> vs. <span class=\"alert\">contextual</span> drivers of variation?\n\n## Goals\n\n- Introduce and discuss two approaches to measuring *clustering* of outcomes across places.\n\n- Understand what it means to include space in models of between-place *variation*. \n\n## Agenda\n\n- Walk through the intraclass correlation example from [@merlo2005]\n\n- What is Moran's I?\n\n- Discuss what we learn from focusing on places vs. spaces as in [@chaix2005].\n\n- If time: Time to get started on *Destination* presentations\n\n## Some warm up questions ðŸ˜…\n\n1. What is the point of using a *global* clustering measure like intraclass correlation?\n\n2. What struck you as interesting or important in these readings?\n\n3. What was confusing or needs clarification?\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"timer_e04c9b2d\" data-warn-when=\"60\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">08</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n\n# What is intraclass correlation and why should you care?\n\n## Intraclass correlation\n\n- An *aspatial* measure of <span class=\"alert\">global</span> clustering.\n\n- Measures the amount of the <span class=\"alert\">total variance</span> in an outcome that is clustered within vs. between <span class=\"alert\">groups</span>\n\n- Groups can include households, neighborhoods, cities, etc.\n\n- ICC is useful when there is individual-level and spatial variation but it is not clear which is <span class=\"alert\">most important</span>\n\n## What is variance?\n\n- <span class=\"alert\">Square</span> of the average deviation from the mean\n\n- So, if standard deviation: $\\sigma$ = 10$, Variance: $\\sigma^2$ = 100.\n\n## The total variance of outcomes in a multi-level dataset is the <span class=\"alert\">sum</span> of the within- and between-group variance\n\n$$\n\\sigma^2_{Total}=\\sigma^2_N+\\sigma^2_I\n$$\n\n- $\\sigma^2_N$ = <span class=\"alert\">Between-neighborhood</span> variance in outcomes.\n\n- $\\sigma^2_I$ = Individual level variance in outcomes from <span class=\"alert\">between-individual</span> variation.\n\n## We can then use these to calculate the ICC\n\n$$\nICC=\\frac{\\sigma_{N}^2}{\\sigma_{N}^2+\\sigma_{I}^2}\n$$\n\nIn words: the ICC is the proportion of the total variation in the outcome that occurs *within* the units we care about.\n\n## Generating data from this model\n\n- $y_{ij}$  = Individual $i$'s' blood pressure \n\n- $\\epsilon_i \\sim N(0, \\sigma_I)$ = Individual-level variability in measured SBP.\n\n- $\\epsilon_j \\sim N(0, \\sigma_N)$ = Neighborhood-level variability in measured SBP.\n\n- $y_{ij} = \\alpha + \\epsilon_i + \\epsilon_j$ reflects the contributions of \n\n## A worked example\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nrequire(ggplot2)\n\nmu_pop <- 120\n\nsigma_pop <- 5\n\nsigma_neighborhood <- 3\n\nJ <- 10\nN <- 100\n\nneighborhoods <- rep(1:J, N)\n\nneighborhood_means <- rnorm(J, mu_pop, sqrt(sigma_neighborhood))\n\nind_sbp <- rnorm(N*J, neighborhood_means[neighborhoods], sqrt(sigma_pop))\n\nhg <- ggplot(data.frame(x=ind_sbp)) + geom_histogram(aes(x=x), binwidth=0.5, colour = \"black\", fill = \"white\") + theme_bw() + \ngeom_vline(xintercept = mean(ind_sbp), linetype = \"dashed\") +\nxlab(\"Systolic Blood Pressure (SBP)\") +\nylab(\"N\")\nplot(hg)\n```\n\n::: {.cell-output-display}\n![](session_9_intraclass_correlation_files/figure-revealjs/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\n\n500 observations of blood pressure with $\\bar{x}$ = 120, $\\sigma^2$ = 8\n\n## Plotting by neighborhood shows that there is more than just <span class=\"alert\">individual</span> variation {.imgslide}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nsbp_limits <- c(min(ind_sbp)-3, max(ind_sbp)+3) \nig <- ggplot() +\ngeom_point(data = data.frame(x=as.factor(neighborhoods), y = ind_sbp), aes(x=x,y=y, colour = x)) + \nxlab(\"Neighborhood\") +\nylab(\"Individual SBP\") +\ntheme_bw() +\ntheme(legend.position = \"none\") +\nylim(sbp_limits)\nplot(ig)\n```\n\n::: {.cell-output-display}\n![](session_9_intraclass_correlation_files/figure-revealjs/unnamed-chunk-3-1.png){width=960}\n:::\n:::\n\n\n\n## Use <span class=\"alert\">neighborhood means</span> to estimate between-neighborhood variance\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n## Make a plot of neighborhood means, ordered from least to greatest\n\nig2 <- ggplot() +\ngeom_point(data = data.frame(x=as.factor(neighborhoods), y = ind_sbp), aes(x=x,y=y, colour = x)) + \ngeom_point(data = data.frame(x=as.factor(1:J), y = neighborhood_means), aes(x=x,y=y), shape = \"x\", size = 5) +\nxlab(\"Neighborhood\") +\nylab(\"Individual SBP\") +\ntheme_bw() +\ntheme(legend.position = \"none\") +\nylim(sbp_limits)\nplot(ig2)\n```\n\n::: {.cell-output-display}\n![](session_9_intraclass_correlation_files/figure-revealjs/unnamed-chunk-4-1.png){width=960}\n:::\n:::\n\n\n## We can use this information to calculate the ICC\n\n- Total Variance = 8\n\n- Neighborhood Variance = 3\n\n- Individual Variance = Total - Neighborhood = 5\n\n- ICC = $\\frac{\\text{individual variance}}{\\text{total variance}}$ = .375\n\n## What does that mean?\n\n- About 38% of variation in SBP outcomes is attributable to neighborhood.\n\n- Seems like a lot, but importance is ultimately relative to the what biological and public health mechanisms are of interest.\n\n- Provides a <span class=\"alert\">basis for comparison</span> with other locations.\n\n# A brief introduction to *Moran's I*\n\n## What is Moran's I?\n\n- A measure of spatial *autocorrelation* in outcomes between *areas*.\n\n- A measure of <span class=\"alert\">global</span> clustering.\n\n- Takes values from -1 to 1\n\n- A very commonly used (and misused) measure of spatial clustering\n\n## What does it measure? \n\n- <span class=\"alert\">Negative</span> values of *I* indicate that neighboring areas are more likely to be dissimilar to each other than non-neighboring ones.\n\n- <span class=\"alert\">Positive</span> values indicate that neighboring values are more likely to be similar to each other. \n\n- Can accomodate a range of ways of calculating values and distances, but here we'll stick to something simple.\n\n## How is it calculated?\n\n$$\nI = \\frac{N}{W} \\frac{\\sum_{i} \\sum_{j} w_{ij} (x_i - \\bar{x})(x_j - \\bar{x})}{\\sum_{i}(x_i \\bar{x})^2}\n$$\n\nWhere:\n\n- N is the number of spatial areas.\n- W is the sum of all the spatial \\alert{weights}\n- $x_i$ and $x_j$ are the values of the i-th and j-th cells\n- $w_{ij}$ indicates whether i & j are <span class=\"alert\">neighbors</span> (yes = 1, no = 0 )\n- $w_ij = 0$ when $i = j$\n- $\\bar{x}$ is the mean value of x across all squares\n\n## In <span class=\"alert\">words</span>, please?\n\n$$\nI = \\frac{N}{W} \\frac{\\sum_{i} \\sum_{j} w_{ij} (x_i - \\bar{x})(x_j - \\bar{x})}{\\sum_{i}(x_i \\bar{x})^2}\n$$\n\n<p>How far is the <span class=\"fragment highlight-current-red\">product of the difference from the population mean of $x_i$ values in neighboring squares </span> from the <span class=\"fragment highlight-current-red\">average distance from the mean for all squares?</span></p>\n\n## Let's start by looking at how this works using *Rook's* contiguity {.imgslide}\n\n<img src=\"examples/output/neighbors/rook.png\">\n\n## As close as you can get to -1 {.imgslide}\n\n<img src=\"examples/output/moran/checkerboard.png\">\n\n## As clustered as you can get $\\to$ 1 {.imgslide}\n\n<img src=\"examples/output/moran/clustered.png\">\n\n## Randomly distributed $\\approx$ 0 {.imgslide}\n\n<img src=\"examples/output/moran/random.png\">\n\n## Randomly distributed $\\approx$ 0 {.imgslide}\n\n<img src=\"examples/output/moran/random_2.png\">\n\n## How does the choice of weights impact this? {.imgslide}\n\n<img src=\"examples/output/neighbors/queen.png\">\n\nLet's try with Queen's contiguity!\n\n## Different weights $\\to$ A different result... {.imgslide}\n\n<div class=\"r-stack\"><img class=\"fragment fade-out\" data-fragment-index=\"0\" src=\"examples/output/moran/checkerboard_queen.png\">\n<img class=\"fragment current-visible\" data-fragment-index=\"0\" src=\"examples/output/moran/clustered_queen.png\">\n<img class=\"fragment\" src=\"examples/output/moran/random_queen.png\"></div>\n\n## What can we learn with this?\n\n- Understand whether the distribution of a disease across <span class=\"alert\">areas</span> is clustered.\n\n- Sensitive to the choice of weights, shape of spatial units, and on and on...\n\n- A <span class=\"alert\">global</span> measure, i.e. says something about the average, but may obscure more <span class=\"alert\">local</span> patterns.\n\n## Bringing the lessons from Merlo and Chaix to your project topics\n\n1. Can you think of an example relevant to your project in which you would want to use either of these clustering measures?\n\n2. What else would you need to know to figure out the cause of the clustering or why itâ€™s important?\n\n3. If a model explained more of the spatial correlation in your residuals  than another model, would you automatically prefer it?\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"timer_869dd571\" data-warn-when=\"60\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">10</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n\n## Next Time {.imgslide}\n\n<img src=\"/images/radon_entry.png\">\n\nBringing in <span class=\"alert\">covariates</span> to explain the drivers of space & place-based variation. \n\n## References\n",
    "supporting": [
      "session_9_intraclass_correlation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/countdown-0.4.0/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}